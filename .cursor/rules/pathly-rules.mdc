---
description: 
globs: 
alwaysApply: true
---
# ğŸ® PuzzlePath - Reglas de Desarrollo del MVP

## ğŸš€ Stack TecnolÃ³gico

* **Framework multiplataforma**: **React Native** + Expo
* **Backend**: **NestJS** (API REST)
* **Generador de niveles**: Python (API externa con IA)
* **Base de datos**: Firebase Firestore (NoSQL)
* **AutenticaciÃ³n**: Firebase Auth (Google + Email)
* **Anuncios y pagos**: AdMob + RevenueCat
* **Deployment**: Expo + Google Play Console + App Store Connect

---

## ğŸ” Reglas de AutenticaciÃ³n

1. Firebase Auth para gestiÃ³n segura del usuario
2. Guardar el `uid` en el backend solo si es necesario para estadÃ­sticas o progreso
3. Toda la comunicaciÃ³n entre frontend y backend debe ir autenticada con Firebase ID Token

---

## ğŸ¨ Reglas de UI/UX

1. Estilo visual **minimalista moderno** con fondo blanco y lÃ­neas grises
2. Paleta de 3 colores:

   * Primario: Azul Puzzle `#3B82F6`
   * Neutro: Gris Claro `#E5E7EB`
   * Ã‰xito: Verde NeÃ³n `#22C55E`
3. Modo oscuro opcional para accesibilidad
4. Layout mobile-only (no responsive necesario)
5. Animaciones suaves al conectar celdas (sin sobrecargar GPU)
6. Accesibilidad mÃ­nima: fuente â‰¥ 14px, botones grandes y contrastes WCAG AA

---

## ğŸ›¡ï¸ Reglas de Seguridad MVP

1. Backend con validaciones en `DTO + Pipes` (NestJS)
2. Escapar siempre los datos antes de renderizarlos en frontend
3. VerificaciÃ³n de payloads del generador IA antes de renderizar
4. LÃ­mite de peticiones: 5 niveles nuevos por minuto por IP
5. Solo permitir orÃ­genes de frontend registrados en producciÃ³n

---

## ğŸ“ Estructura del CÃ³digo

```plaintext
Frontend (React Native):
- components/      â†’ Elementos UI reutilizables (Cell, Button, Grid)
- screens/         â†’ Home, Game, Settings, Login
- services/        â†’ Firebase, RevenueCat, AdMob
- utils/           â†’ helpers, validadores, colores
- store/           â†’ Zustand o Context API para estado global

Backend (NestJS):
- src/
  â”œâ”€â”€ auth/        â†’ JWT, guards
  â”œâ”€â”€ user/        â†’ Registro de progreso
  â”œâ”€â”€ levels/      â†’ Endpoints para niveles
  â””â”€â”€ shared/      â†’ Pipes, DTOs, interceptors
```

---

## âš¡ Reglas de Performance

1. Tiempo mÃ¡ximo de carga del nivel: **300 ms**
2. Generador de niveles IA con respuesta en < 1s
3. Cachear los niveles generados durante 24h
4. Lazy loading de pantallas en React Native (`expo-router`)
5. App size < 30 MB

---

## ğŸ“¦ Reglas de MonetizaciÃ³n

1. **1 pista gratis por nivel**
2. **Siguientes pistas requieren ver un anuncio**
3. **1 anuncio intersticial cada 4 niveles jugados**
4. Plan Pro (RevenueCat):

   * **1,99 â‚¬/mes** (sin anuncios, pistas ilimitadas)
   * **10 â‚¬ pago Ãºnico** (versiÃ³n premium de por vida)

---

## ğŸ¥š Reglas de Testing

1. Test manual en Android/iOS tras cada sprint
2. LÃ³gica del juego probada con `unit tests`
3. ValidaciÃ³n automÃ¡tica de niveles generados
4. Tests de UI con Expo + Jest + Testing Library

---

## ğŸ”„ Flujo de Trabajo y Git

### âœ”ï¸ Branching

* `main`: rama estable (solo merge de versiones listas)
* `dev`: rama de desarrollo activa
* `feature/<nombre>`: nuevas funcionalidades
* `fix/<nombre>`: correcciÃ³n de errores

### ğŸ§ ConvenciÃ³n de Commits (Semantic Commits)

```bash
feat(game): aÃ±ade validaciÃ³n de camino
fix(auth): corrige error de logout automÃ¡tico
refactor(ui): simplifica botÃ³n de pista
test(level): aÃ±ade test para generador extremo
```

### ğŸ“Œ Reglas Git

1. **Commits pequeÃ±os y frecuentes**
2. Nunca hacer `force push` en main/dev
3. Merge a `dev` solo tras revisiÃ³n (pull request)
4. Actualizar `README.md` si se modifica estructura o uso
5. Siempre incluir `.env.example` con variables de entorno

---

## ğŸ—–ï¸ Feature Flags y QA

1. Habilitar funcionalidades nuevas con `feature flags` por usuario
2. QA con testers reales desde TestFlight / Play Console (alpha)
3. EnvÃ­o automÃ¡tico de errores con Sentry (opcional)
